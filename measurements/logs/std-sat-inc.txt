
/**
 * Imports for stochastic queries
 */
import "http://www.eclipse.org/emf/2002/Ecore"
import "http://www.example.org/tracemodel"

import java reliability.mdd.COLLECT;
import java reliability.mdd.OR;
import java reliability.mdd.NOT;
import java reliability.intreface.D;
import java hu.bme.mit.delta.mdd.MddHandle; 
import java reliability.mdd.MddHandleCollection;
import java reliability.events.Event;

/**
 * Imports for weight functions
 */
import java hu.bme.mit.inf.dslreasoner.domains.satellite1.performability.Performability
import java hu.bme.mit.inf.dslreasoner.domains.satellite1.performability.Performability

/**
 * Imports from the original model
 */
import "http://www.example.org/satellite1"

/**
 * User defined patterns
 */
 pattern onlineWithPayload(sat:Spacecraft,coverage:java ^java.lang.Double)
{
	Spacecraft.payload(sat,pld);
	collectionOf_coverage == COLLECT find payloadAvailable(pld,#_);
	TraceModel.probabilities(_,internal_probabilities);
	//Cast: to avoid a false error indication in eclipse
	coverage == eval(D.WeightCollection(collectionOf_coverage as MddHandleCollection, [cnt | hu.bme.mit.inf.dslreasoner.domains.satellite1.performability.Performability.P(cnt)], internal_probabilities));
}
 pattern coverage(coverage:java ^java.lang.Double)
{
	collectionOf_coverage == COLLECT find payloadAvailable(_,#_);
	TraceModel.probabilities(_,internal_probabilities);
	//Cast: to avoid a false error indication in eclipse
	coverage == eval(D.WeightCollection(collectionOf_coverage as MddHandleCollection, [cnt | hu.bme.mit.inf.dslreasoner.domains.satellite1.performability.Performability.calculate(cnt)], internal_probabilities));
}
 pattern payloadAvailable(pld:Payload,event: java Event){
	find ua_payloadAvailable(pld,_);
	event == OR find ua_payloadAvailable(pld,#_);
}
private pattern ua_payloadAvailable(pld:Payload,event: java Event)
{
	Spacecraft.payload(sat,pld);
	find online(sat,event);
}
 pattern ready(comm:CommSubsystem,event: java Event){
	find ua_ready(comm,_);
	event == OR find ua_ready(comm,#_);
}
private pattern ua_ready(comm:CommSubsystem,event: java Event)
{
	GroundStationNetwork.commSubsystem(_,comm);
	TraceModel.mddTrue(_, event);
} or 
{
	Spacecraft.commSubsystem(sat,comm);
	find commHW(comm,event0);
	find online(sat,event1);
	event==eval(D.AND(event0,event1));
}
 pattern online(sat:Spacecraft,event: java Event){
	find ua_online(sat,_);
	event == OR find ua_online(sat,#_);
}
private pattern ua_online(sat:Spacecraft,event: java Event)
{
	Spacecraft.commSubsystem(sat,src);
	find satHW(sat,event0);
	find commHW(src,event1);
	find link(src,trg);
	find ready(trg,event2);
	event==eval(D.AND(event0,event1,event2));
}
 pattern nolink(comm:CommSubsystem)
{
	neg find link(comm,_);
}
 pattern link(src:CommSubsystem,trg:CommSubsystem)
{
	CommSubsystem.target(src,trg);
} or 
{
	CommSubsystem.fallback(src,trg);
}
 pattern clean_satHW(element:Spacecraft)
{
	find satHW(element,_);
	//Stochastic constraint is ignored (always match):
	//event_idx == NOT find commHW(element,#_);
	a==count find satHW(_,_);
}
 pattern satHW(element:Spacecraft,event: java Event){
	find ua_satHW(element,_);
	event == OR find ua_satHW(element,#_);
}
private pattern ua_satHW(element:Spacecraft,event: java Event)
{
	find use_defC3U(element,_,event);
} or 
{
	find use_defC6U(element,event);
} or 
{
	find use_defSS(element,event);
}
 pattern commHW(element:CommSubsystem,event: java Event){
	find ua_commHW(element,_);
	event == OR find ua_commHW(element,#_);
}
private pattern ua_commHW(element:CommSubsystem,event: java Event)
{
	find use_defXComm(element,event);
} or 
{
	find use_defKaComm(element,event);
} or 
{
	find use_defUHFComm(element,event);
}
 pattern defC3U(element:CubeSat3U,p:java ^java.lang.Double)
{
	CubeSat3U(element);
	p==0.98400034407713;
}
 pattern defC6U(element:CubeSat6U)
{
	CubeSat6U(element);
}
 pattern defSS(element:SmallSat)
{
	SmallSat(element);
}
 pattern defXComm(element:XCommSubsystem)
{
	XCommSubsystem(element);
	Spacecraft.commSubsystem(_,element);
}
 pattern defKaComm(element:KaCommSubsystem)
{
	KaCommSubsystem(element);
	Spacecraft.commSubsystem(_,element);
}
 pattern defUHFComm(element:UHFCommSubsystem)
{
	UHFCommSubsystem(element);
	Spacecraft.commSubsystem(_,element);
}
 pattern stochasticCount(cnt:java ^java.lang.Integer)
{
	cnt1==count find commHW(_,_);
	cnt2==count find satHW(_,_);
	cnt3==count find online(_,_);
	cnt4==count find ready(_,_);
	cnt5==count find payloadAvailable(_,_);
	cnt==eval(cnt1 +
	 cnt2 +
	 cnt3 +
	 cnt4 +
	 cnt5);
}

/**
 * Event require pattern
 */
pattern BERequiredName1(arg1:EObject,name: java String, index: java Integer, probability: java Double)
{
	find BERequiredName1_many(arg1,name, index, _);
	probability == max find BERequiredName1_many(arg1,name, index, #_);
}

pattern BERequiredName1_many(arg1:EObject,name: java String, index: java Integer, probability: java Double)
{
	find defC3U(arg1,probability);
	name == "defC3U";
	index == 1;
} or 
{
	find defC6U(arg1);
	probability == 0.98496269152523;
	name == "defC6U";
	index == 1;
} or 
{
	find defSS(arg1);
	probability == 0.98581584235241;
	name == "defSS";
	index == 1;
} or 
{
	find defXComm(arg1);
	probability == 0.92596107864232;
	name == "defXComm";
	index == 1;
} or 
{
	find defKaComm(arg1);
	probability == 0.90483741803596;
	name == "defKaComm";
	index == 1;
} or 
{
	find defUHFComm(arg1);
	probability == 0.92004441462932;
	name == "defUHFComm";
	index == 1;
}

private pattern use_defC3U(element:CubeSat3U,p:java ^java.lang.Double, event: java Event){
	//find defC3U(element,p);
	find HandleOf1(element,"defC3U",event);
	find BETrace1(element,"defC3U",1,trace);
	Trace.probability(trace,p);
	 
}
private pattern use_defC6U(element:CubeSat6U, event: java Event){
	//find defC6U(element);
	find HandleOf1(element,"defC6U",event);
	 
}
private pattern use_defSS(element:SmallSat, event: java Event){
	//find defSS(element);
	find HandleOf1(element,"defSS",event);
	 
}
private pattern use_defXComm(element:XCommSubsystem, event: java Event){
	//find defXComm(element);
	find HandleOf1(element,"defXComm",event);
	 
}
private pattern use_defKaComm(element:KaCommSubsystem, event: java Event){
	//find defKaComm(element);
	find HandleOf1(element,"defKaComm",event);
	 
}
private pattern use_defUHFComm(element:UHFCommSubsystem, event: java Event){
	//find defUHFComm(element);
	find HandleOf1(element,"defUHFComm",event);
	 
}

/**
 * Interface queries for event management
 */
pattern BETrace1(arg1:EObject, name: EString, index: EInt, trace: Trace1){
	Trace1.arg1(trace, arg1);
	Trace.generator(trace, name);
	Trace.index(trace, index);
}

pattern Insertion1(arg1:EObject, name: java String, from: java Integer, to: java Integer, probability: java Double){
	find BERequiredName1(arg1, name, to, probability);
	neg find BETrace1(arg1, name, _, _);
	from == 0;
} or {
	find BERequiredName1(arg1, name, to, probability);
	find BETrace1(arg1, name, _, _);
	from == max find BETrace1(arg1, name, #_, _);
	check(to > from);
}

pattern Removal1(trace: Trace1){
	Trace1.arg1(trace, arg1);
	Trace.generator(trace, name);
	neg find BERequiredName1(arg1, name, _, _);
} or {
	find BERequiredName1(arg1, name, multiplicity, _);
	Trace1.arg1(trace, arg1);
	Trace.generator(trace, name);
	Trace.index(trace, idx);
	check(idx > multiplicity);
}

pattern Update1(trace: Trace1, probability: java Double){
	find BERequiredName1(arg1, name, multiplicity, probability);
	find BETrace1(arg1, name, index, trace);
	Trace.probability(trace, old);
	old != probability;
	check(index <= multiplicity);
}

pattern HandleOf1(arg1:EObject, name: EString, event: Handle){
	find BETrace1(arg1, name, _, trace);
	Trace.event(trace, event);
}



[main] INFO hu.bme.mit.inf.measurement.utilities.viatra.ViatraBaseRunner - Queries /**
 * Imports for stochastic queries
 */
import "http://www.eclipse.org/emf/2002/Ecore"
import "http://www.example.org/tracemodel"

import java reliability.mdd.COLLECT;
import java reliability.mdd.OR;
import java reliability.mdd.NOT;
import java reliability.intreface.D;
import java hu.bme.mit.delta.mdd.MddHandle; 
import java reliability.mdd.MddHandleCollection;
import java reliability.events.Event;

/**
 * Imports for weight functions
 */
import java hu.bme.mit.inf.dslreasoner.domains.satellite1.performability.Performability
import java hu.bme.mit.inf.dslreasoner.domains.satellite1.performability.Performability

/**
 * Imports from the original model
 */
import "http://www.example.org/satellite1"

/**
 * User defined patterns
 */
 pattern onlineWithPayload(sat:Spacecraft,coverage:java ^java.lang.Double)
{
	Spacecraft.payload(sat,pld);
	collectionOf_coverage == COLLECT find payloadAvailable(pld,#_);
	TraceModel.probabilities(_,internal_probabilities);
	//Cast: to avoid a false error indication in eclipse
	coverage == eval(D.WeightCollection(collectionOf_coverage as MddHandleCollection, [cnt | hu.bme.mit.inf.dslreasoner.domains.satellite1.performability.Performability.P(cnt)], internal_probabilities));
}
 pattern coverage(coverage:java ^java.lang.Double)
{
	collectionOf_coverage == COLLECT find payloadAvailable(_,#_);
	TraceModel.probabilities(_,internal_probabilities);
	//Cast: to avoid a false error indication in eclipse
	coverage == eval(D.WeightCollection(collectionOf_coverage as MddHandleCollection, [cnt | hu.bme.mit.inf.dslreasoner.domains.satellite1.performability.Performability.calculate(cnt)], internal_probabilities));
}
 pattern payloadAvailable(pld:Payload,event: java Event){
	find ua_payloadAvailable(pld,_);
	event == OR find ua_payloadAvailable(pld,#_);
}
private pattern ua_payloadAvailable(pld:Payload,event: java Event)
{
	Spacecraft.payload(sat,pld);
	find online(sat,event);
}
 pattern ready(comm:CommSubsystem,event: java Event){
	find ua_ready(comm,_);
	event == OR find ua_ready(comm,#_);
}
private pattern ua_ready(comm:CommSubsystem,event: java Event)
{
	GroundStationNetwork.commSubsystem(_,comm);
	TraceModel.mddTrue(_, event);
} or 
{
	Spacecraft.commSubsystem(sat,comm);
	find commHW(comm,event0);
	find online(sat,event1);
	event==eval(D.AND(event0,event1));
}
 pattern online(sat:Spacecraft,event: java Event){
	find ua_online(sat,_);
	event == OR find ua_online(sat,#_);
}
private pattern ua_online(sat:Spacecraft,event: java Event)
{
	Spacecraft.commSubsystem(sat,src);
	find satHW(sat,event0);
	find commHW(src,event1);
	find link(src,trg);
	find ready(trg,event2);
	event==eval(D.AND(event0,event1,event2));
}
 pattern nolink(comm:CommSubsystem)
{
	neg find link(comm,_);
}
 pattern link(src:CommSubsystem,trg:CommSubsystem)
{
	CommSubsystem.target(src,trg);
} or 
{
	CommSubsystem.fallback(src,trg);
}
 pattern clean_satHW(element:Spacecraft)
{
	find satHW(element,_);
	//Stochastic constraint is ignored (always match):
	//event_idx == NOT find commHW(element,#_);
	a==count find satHW(_,_);
}
 pattern satHW(element:Spacecraft,event: java Event){
	find ua_satHW(element,_);
	event == OR find ua_satHW(element,#_);
}
private pattern ua_satHW(element:Spacecraft,event: java Event)
{
	find use_defC3U(element,_,event);
} or 
{
	find use_defC6U(element,event);
} or 
{
	find use_defSS(element,event);
}
 pattern commHW(element:CommSubsystem,event: java Event){
	find ua_commHW(element,_);
	event == OR find ua_commHW(element,#_);
}
private pattern ua_commHW(element:CommSubsystem,event: java Event)
{
	find use_defXComm(element,event);
} or 
{
	find use_defKaComm(element,event);
} or 
{
	find use_defUHFComm(element,event);
}
 pattern defC3U(element:CubeSat3U,p:java ^java.lang.Double)
{
	CubeSat3U(element);
	p==0.98400034407713;
}
 pattern defC6U(element:CubeSat6U)
{
	CubeSat6U(element);
}
 pattern defSS(element:SmallSat)
{
	SmallSat(element);
}
 pattern defXComm(element:XCommSubsystem)
{
	XCommSubsystem(element);
	Spacecraft.commSubsystem(_,element);
}
 pattern defKaComm(element:KaCommSubsystem)
{
	KaCommSubsystem(element);
	Spacecraft.commSubsystem(_,element);
}
 pattern defUHFComm(element:UHFCommSubsystem)
{
	UHFCommSubsystem(element);
	Spacecraft.commSubsystem(_,element);
}
 pattern stochasticCount(cnt:java ^java.lang.Integer)
{
	cnt1==count find commHW(_,_);
	cnt2==count find satHW(_,_);
	cnt3==count find online(_,_);
	cnt4==count find ready(_,_);
	cnt5==count find payloadAvailable(_,_);
	cnt==eval(cnt1 +
	 cnt2 +
	 cnt3 +
	 cnt4 +
	 cnt5);
}

/**
 * Event require pattern
 */
pattern BERequiredName1(arg1:EObject,name: java String, index: java Integer, probability: java Double)
{
	find BERequiredName1_many(arg1,name, index, _);
	probability == max find BERequiredName1_many(arg1,name, index, #_);
}

pattern BERequiredName1_many(arg1:EObject,name: java String, index: java Integer, probability: java Double)
{
	find defC3U(arg1,probability);
	name == "defC3U";
	index == 1;
} or 
{
	find defC6U(arg1);
	probability == 0.98496269152523;
	name == "defC6U";
	index == 1;
} or 
{
	find defSS(arg1);
	probability == 0.98581584235241;
	name == "defSS";
	index == 1;
} or 
{
	find defXComm(arg1);
	probability == 0.92596107864232;
	name == "defXComm";
	index == 1;
} or 
{
	find defKaComm(arg1);
	probability == 0.90483741803596;
	name == "defKaComm";
	index == 1;
} or 
{
	find defUHFComm(arg1);
	probability == 0.92004441462932;
	name == "defUHFComm";
	index == 1;
}

private pattern use_defC3U(element:CubeSat3U,p:java ^java.lang.Double, event: java Event){
	//find defC3U(element,p);
	find HandleOf1(element,"defC3U",event);
	find BETrace1(element,"defC3U",1,trace);
	Trace.probability(trace,p);
	 
}
private pattern use_defC6U(element:CubeSat6U, event: java Event){
	//find defC6U(element);
	find HandleOf1(element,"defC6U",event);
	 
}
private pattern use_defSS(element:SmallSat, event: java Event){
	//find defSS(element);
	find HandleOf1(element,"defSS",event);
	 
}
private pattern use_defXComm(element:XCommSubsystem, event: java Event){
	//find defXComm(element);
	find HandleOf1(element,"defXComm",event);
	 
}
private pattern use_defKaComm(element:KaCommSubsystem, event: java Event){
	//find defKaComm(element);
	find HandleOf1(element,"defKaComm",event);
	 
}
private pattern use_defUHFComm(element:UHFCommSubsystem, event: java Event){
	//find defUHFComm(element);
	find HandleOf1(element,"defUHFComm",event);
	 
}

/**
 * Interface queries for event management
 */
pattern BETrace1(arg1:EObject, name: EString, index: EInt, trace: Trace1){
	Trace1.arg1(trace, arg1);
	Trace.generator(trace, name);
	Trace.index(trace, index);
}

pattern Insertion1(arg1:EObject, name: java String, from: java Integer, to: java Integer, probability: java Double){
	find BERequiredName1(arg1, name, to, probability);
	neg find BETrace1(arg1, name, _, _);
	from == 0;
} or {
	find BERequiredName1(arg1, name, to, probability);
	find BETrace1(arg1, name, _, _);
	from == max find BETrace1(arg1, name, #_, _);
	check(to > from);
}

pattern Removal1(trace: Trace1){
	Trace1.arg1(trace, arg1);
	Trace.generator(trace, name);
	neg find BERequiredName1(arg1, name, _, _);
} or {
	find BERequiredName1(arg1, name, multiplicity, _);
	Trace1.arg1(trace, arg1);
	Trace.generator(trace, name);
	Trace.index(trace, idx);
	check(idx > multiplicity);
}

pattern Update1(trace: Trace1, probability: java Double){
	find BERequiredName1(arg1, name, multiplicity, probability);
	find BETrace1(arg1, name, index, trace);
	Trace.probability(trace, old);
	old != probability;
	check(index <= multiplicity);
}

pattern HandleOf1(arg1:EObject, name: EString, event: Handle){
	find BETrace1(arg1, name, _, trace);
	Trace.event(trace, event);
}



[main] INFO hu.bme.mit.inf.measurement.utilities.viatra.ViatraBaseRunner - [WARMUP 0 (1 of 11) ]===============================================================
[main] INFO hu.bme.mit.inf.measurement.utilities.viatra.ViatraBaseRunner - [ITERATION 0 of 4 WARMUP 0 (1 of 11) ]===============================================================
[main] INFO reliability.mdd.MddModel - Removed 0
[main] INFO reliability.mdd.MddModel - Updated 0
[main] INFO reliability.mdd.MddModel - Insertions 38
Finally block executed.
[main] INFO reliability.mdd.MddModel - Removed 0
[main] INFO reliability.mdd.MddModel - Updated 0
[main] INFO reliability.mdd.MddModel - Insertions 38
Finally block executed.
Action addPayload succeeded. (1 of 1)
[main] INFO hu.bme.mit.inf.measurement.utilities.viatra.ViatraBaseRunner - [ITERATION 1 of 4 WARMUP 0 (1 of 11) ]===============================================================
[main] INFO reliability.mdd.MddModel - Removed 0
[main] INFO reliability.mdd.MddModel - Updated 0
[main] INFO reliability.mdd.MddModel - Insertions 0
Finally block executed.
[main] INFO reliability.mdd.MddModel - Removed 0
[main] INFO reliability.mdd.MddModel - Updated 0
[main] INFO reliability.mdd.MddModel - Insertions 38
Finally block executed.
